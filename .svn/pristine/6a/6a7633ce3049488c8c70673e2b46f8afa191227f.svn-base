<style type="text/css">
.chekuang{ background: #FFFFFF; padding: 0 0.32rem;}
.chekuang textarea{ width: 100%; height: 3rem; box-sizing: border-box; border: 1px solid #8A8F9B; padding: 0.22rem 0.23rem; border-radius: 0.06rem; margin-bottom: 0.48rem; margin-top: 0.3rem;}

	.choice_chekuang{
		margin-top: 20px;
    display: -webkit-box;
    display: -ms-flexbox;
    display: -webkit-flex;
    display: flex;
    -webkit-box-pack: center;
    -ms-flex-pack: center;
    -webkit-justify-content: center;
    justify-content: center;
    -webkit-box-align: center;
    -ms-flex-align: center;
    -webkit-align-items: center;
    align-items: center;
}
.choice_chekuang .item{
    margin: 0 0.3rem;
}
.choice_chekuang .item .color{
    width: 45px;
    height: 25px;
}
.choice_chekuang .item.xiangpica .color{
    background: url("/static/admin/images/xiangpica.png") no-repeat;
    background-size: 100% 100%;
}
.choice_chekuang .item p{
    font-size: 14px;
    color: #8A8F9B;
    text-align: center;
    line-height: 40px;
}
.chekuangbiaoji{
    position: absolute;
    width: 20px;
    height: 20px;
    border-radius: 100%;
}
</style>
<div class="content-hd">
	<fieldset class="layui-elem-field layui-field-title" >
		<legend>{$pagetitle}</legend>
	</fieldset>
</div>
<div class="rhaphp-srivice-register">
	<form class="layui-form layui-form-pane" action="/addCarSource" lay-filter="example" method="post">
		<div class="layui-form-item">
			<label class="layui-form-label"><i class="required-color">*</i>列表封面</label>
			<div class="layui-upload-drag" id="up_img">
				<input type="hidden" >
				<img src="" style="display: none;background: #ddd" alt="">
				<i class="layui-icon"></i>
				<p>点击上传，或将文件拖拽到此处</p>
			</div>
		</div>
		 <div class="layui-form-item">
			<label class="layui-form-label"><i class="required-color">*</i>VIN码</label>
			<div class="layui-input-inline">
				<input name="shop_name" required="" lay-verify="required|notutf8|max:17" placeholder="请输入车辆VIN码" maxlength="17" autocomplete="off" class="layui-input" type="text">
			</div>
		</div>
		<div class="layui-form-item">
				<label class="layui-form-label"><i class="required-color">*</i>品牌型号</label>
				<div class="layui-input-inline">
					<select name="brand_id"  required="" lay-verify="required" lay-filter="brand_id" id="brand_id" lay-search>
						<option value="">品牌</option>
					</select>
				</div>
				<div class="layui-input-inline">
					<select name="series_id" required="" lay-verify="required" lay-filter="series_id" id="series_id" lay-search>
						<option value="">车系</option>
					</select>
				</div>
				<div class="layui-input-inline">
					<select name="model_id" required="" lay-verify="required" lay-filter="model_id" id="model_id" lay-search>
						<option value="">车型</option>
					</select>
				</div>
			</div>
		<div class="layui-form-item">
				<label class="layui-form-label"><i class="required-color">*</i>车况信息</label>
				<div class="layui-input-inline">
					<!-- <input name="user_name" required="" lay-verify="required|max:20" placeholder="请输入负责人" maxlength="20" autocomplete="off" class="layui-input" type="text"> name="img" lay-verify="imgs"-->
					<p class="layui-form-mid layui-word-aux" style="width: 320px">请选择相应颜色后点击于车辆剖面图上</p>		
					<div class="chekuang">
					
					<div id="myCanvas" style="width: 320px;height: 402px;position: relative;left: 50%;margin-left: -120px;margin-top: 30px">
						<img src="/static/admin/images/paomiantu.png">
						<div id="div1" style="position: absolute;width: 48px;height: 88px;top: 57px;left: 55px;" ids="1" des="左前翼子板"></div>
						<div id="div2" style="position: absolute;width: 48px;height: 88px;top: 57px;right: 53px;" ids="2" des="右前翼子板"></div>
						<div id="div3" style="position: absolute;width: 132px;height: 25px;top: 23px;left: 95px;" ids="3" des="前保险杠"></div>
						<div id="div4" style="position: absolute;width: 126px;height: 25px;bottom: 30px;left: 98px;" ids="4" des="后保险杠"></div>
						<div id="div5" style="position: absolute;width: 48px;height: 60px;top: 144px;left: 56px;" ids="5" des="左前门"></div>
						<div id="div6" style="position: absolute;width: 48px;height: 60px;top: 203px;left: 56px;" ids="6" des="左后门"></div>
						<div id="div7" style="position: absolute;width: 48px;height: 60px;top: 144px;right: 54px;" ids="7" des="右前门"></div>
						<div id="div8" style="position: absolute;width: 48px;height: 60px;top: 203px;right: 54px;" ids="8" des="右后门"></div>
						<div id="div9" style="position: absolute;width: 48px;height: 70px;top: 263px;left: 55px;" ids="9" des="左后翼子板"></div>
						<div id="div10" style="position: absolute;width: 48px;height: 70px;top: 263px;right: 53px;" ids="10" des="右后翼子板"></div>
						<div id="div11" style="position: absolute;width: 114px;height: 66px;top: 58px;right: 103px;" ids="11" des="前引擎盖"></div>
						<div id="div12" style="position: absolute;width: 63px;height: 92px;top: 157px;right: 128px;" ids="12" des="车顶"></div>
						<div id="div13" style="position: absolute;width: 114px;height: 54px;top: 279px;right: 102px;" ids="13" des="后备箱盖"></div>
					</div>
					<div class="choice_chekuang">
						<div class="item">
							<div class="color" style="background: #4FC473;" id="penqi"></div>
							<p>喷漆</p>
						</div>
						<div class="item">
							<div class="color" style="background: #FCC022;" id="banjin"></div>
							<p>钣金</p>
						</div>
						<div class="item">
							<div class="color" style="background: #FF2F2F;" id="shigu"></div>
							<p>事故</p>
						</div>
						<div class="item xiangpica">
							<div class="color" id="xiangpica"></div>
							<p>橡皮擦</p>
						</div>
					</div>
					<p class="chektit">车况描述</p>
					<textarea placeholder="请输入车况描述" rows="" cols=""></textarea>
				</div>
			</div>
		
	</div>
		
			<div class="layui-form-item">
				<div class="layui-input-block">
					<button type="button" class="layui-btn"  lay-submit="" lay-filter="*">保存</button>
					<a class="layui-btn layui-btn-primary" href="javascript:history.back(-1);">取消</a>
				</div>
			</div>
		</div>
	</form>
</div>

<script>
	
        $('#beginTime,#endTime').blur(function(){
        	var stime = $("#beginTime").val();
        	var etime = $("#endTime").val();
        	if(stime || etime){
        		$("#money").attr({"required":'required',"lay-verify":"required|number"})
        	}else{
				$("#money").removeAttr('required').removeAttr('lay-verify');
        	}
        })
        function is_set_tiem(){
        	var stime = $("#beginTime").val();
        	var etime = $("#endTime").val();
        	if(stime || etime){
        		$("#money").attr({"required":'required',"lay-verify":"required|number"})
        	}else{
				$("#money").removeAttr('required').removeAttr('lay-verify');
        	}
        }
	layui.use(['laydate','form'],function(){
		laydate = layui.laydate;
		form = layui.form;
form.verify({
        imgs: function(value){
          if(!value){
            return '汽车图片必须上传';
          }
        }
         ,notutf8: function(value){
             var myReg = /[\u4e00-\u9fa5]/;
           if (myReg.test(value)) {
               return '不能含有中文';
           }
        }
        ,pass: [
          /^[A-Za-z0-9]{8,}/
          ,'密码最少设置8位，且不能出现空格'
        ]
        ,intmoney:[
        /^[1-9]\d*00$/
        ,'充值金额必须为100的倍数'
        ]
      });
	//开始时间时间
	var start = laydate.render({
		elem: '#beginTime',
		min: '1900-1-1 00:00:00',
	    max: '2099-6-16 23:59:59',
	    trigger: 'click', //采用click弹出
	    done: function(value, date, endDate){
	      end.config.min = {
			year: date.year,
			month: date.month - 1,
			date: date.date,
			hours: date.hours,
			minutes: date.minutes,
			seconds: date.seconds
	      }; //开始日选好后，重置结束日的最小日期
	      end.config.value = {
			year: date.year,
			month: date.month - 1,
			date: date.date,
			hours: date.hours,
			minutes: date.minutes,
			seconds: date.seconds
		 }; //将结束日的初始值设定为开始日
		 is_set_tiem();
	   }
	});
	
	//结束时间
	var end = laydate.render({
		elem: '#endTime',
	    min: '1900-1-1 00:00:00',
	    max: '2099-6-16 23:59:59',
	    trigger: 'click', //采用click弹出
	    done: function(value, date, endDate){
	      start.config.max = {
			year: date.year,
			month: date.month - 1,
			date: date.date,
			hours: date.hours,
			minutes: date.minutes,
			seconds: date.seconds
	      }; //结束日选好后，重置开始日的最大日期
		 is_set_tiem();

	    }
	});
	$(function(){
		province_list()
	})
	function province_list(type){
		var type = type ? type :2;
		$.post("/CarProvinceList",{type:type,token:"{$admin_token}"},function(data){
			// console.log(data);
			var city = data.data;
			if(city){
				var  str = '<option value="">省</option>';
				$.each(city,function(i,v){
					str +='<option value="'+v.id+'">'+v.text+'</option>';
				})
				// console.log(str)
				$('#province_id').html(str);
				form.render('select');
			}
		})
	}
	function cities_list(ids){
		$.post("/CarCitiesList",{id:ids,token:"{$admin_token}"},function(data){
			// console.log(data);
			var city = data.data;
			if(city){
				var  str = '<option value="">市</option>';
				$.each(city,function(i,v){
					str +='<option value="'+v.id+'">'+v.text+'</option>';
				})
				// console.log(str)
				$('#room_city').html(str);
				form.render('select');
			}
		})
	}
	function market_list(id){
		$.post("/CarMarketList",{id:id,token:"{$admin_token}"},function(data){
			console.log(data);
			var city = data.data;
			if(city){
				var  str = '<option value="">请选择市场</option>';
				$.each(city,function(i,v){
					str +='<option value="'+v.id+'">'+v.text+'</option>';
				})
				$('#market').html(str);
				form.render('select');
			}
		})
	}
	form.on('select(province_id)', function(data){
	  var ids = data.value;
	  cities_list(ids);
	}); 
	form.on('select(room_city)', function(data){
	  var id = data.value;
	  console.log(id)
	  market_list(id);
	}); 
})
	function yiziban(num){

		console.log("yiziban"+num)
	}
</script>
<script type="text/javascript">
	(function($){
	        $.fn.draw = function(obj){
	        	return this.each(function(){
	        		var color = "";
	        		var color_id = 0;
	        		var mcdt = $("#myCanvas").offset().top;
				    var mcdl = $("#myCanvas").offset().left;
	        		var self = $(this);    		
        			self.mousedown(function(e){
        				if(color == "" && color_id == 0){
        			        console.log("color为空")
        		        }else{
        		        	var des = self.attr("des");
        		        	var ids = self.attr("ids");
							var _x = e.pageX;
							var _y = e.pageY;
							console.log(_x,_y);
							var px = _x - mcdl;
							var py = _y - mcdt;
							px = px - 10;
							py = py - 10;
							console.log(px,py);
							$(document).mouseup(function(){
	                				                	
			                	$(document).unbind('mouseup');
			                	var div = '<div class="chekuangbiaoji" style="left:'+ px +'px ;top:'+ py +'px ;background:'+ color +';" ids="'+ids+'"des="'+ des +'" color_id ="'+ color_id +'"></div>';
						        $("#myCanvas").append(div);		
			                    
			                })
						}
		                return false
					});
					$("#penqi").click(function(){
						color = "#4FC473";
						color_id = 1;
					});
					$("#banjin").click(function(){
						color = "#FCC022";
						color_id = 2;
					});
					$("#shigu").click(function(){
						color = "#FF2F2F";
						color_id = 3;
					});
					$("#xiangpica").click(function(){
						color = "";
						$(".chekuangbiaoji").click(function(){
							if(color == ""){
								$(this).remove();
							}
						});
					});
	        		
	        	})
	        }
	    })(jQuery)
</script>
	<script type="text/javascript">
		$(function(){	
				$("#div1").draw();
				$("#div2").draw();
				$("#div3").draw();
				$("#div4").draw();
				$("#div5").draw();
				$("#div6").draw();
				$("#div7").draw();
				$("#div8").draw();
				$("#div9").draw();
				$("#div10").draw();
				$("#div11").draw();
				$("#div12").draw();
				$("#div13").draw();
			})	
	</script>